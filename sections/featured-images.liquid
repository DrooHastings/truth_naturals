{% assign image_count = section.blocks.size %}
{% if image_count > 4 %}
  {% assign column_count = 3 %}
{% else %}
  {% assign column_count = 12 | divided_by: image_count %}
{% endif %}

<div class="featured-images--root">
  <div class="widgets">
    <div class="small-promos">
      <div class="row custom-gallery">
        <h2 class='custom-section-title'>{{ section.settings.section_title }}</h2>
        {% for block in section.blocks limit: image_count %}
            <div class="columns large-{{ column_count }}">
              {% case column_count %}
                {% when 3 %}
                  {%- assign image_size = '800x' -%}
                {% when 4 %}
                  {%- assign image_size = '1066x' -%}
                {% when 6 %}
                  {%- assign image_size = '1600x' -%}
                {% when 12 %}
                  {%- assign image_size = '3200x' -%}
              {% endcase %}

              <div class="image-text-widget">
                {% if block.settings.link.size > 0 %}
                  <a href="{{ block.settings.link }}">
                {% endif %}

                {% if block.settings.image == blank %}
                  {% include "framework--placeholder",
                    type: "image",
                    alternate_colors: true,
                    aspect_ratio: "800x800"
                  %}
                {% else %}
                  {{ block.settings.image | img_url: image_size | img_tag: block.settings.image.alt | default: '' }}
                {% endif %}

                {% if block.settings.image-title.size > 0 or block.settings.sub-title.size > 0 %}
                  <div class="caption">
                    <div class="bg"></div>
                    <div class="inner">
                      {% if block.settings.image-title.size > 0 %}
                        <h1>{{ block.settings.image-title | escape }}</h1>
                      {% endif %}
                      {% if block.settings.sub-title.size > 0 %}
                        <h2>{{ block.settings.sub-title | escape }}</h2>
                      {% endif %}
                    </div>
                  </div>
                {% endif %}

                {% if block.settings.link.size > 0 %}
                  </a>
                {% endif %}
              </div>

            </div>

        {% endfor %}

      </div> <!-- .row -->
    </div> <!-- .small-promos -->
  </div> <!-- .widgets -->
</div>

{% if section.blocks.size == 0 %}
  {% include 'snippet-no-blocks' %}
{% endif %}

{% schema %}
{
  "class": "section--featured-images",
  "name": "Gallery",
  "max_blocks": 8,
  "settings": [
		{
			"type": "text",
			"id": "section_title",
			"label": "Section Title",
			"default": "Section Title"
		}
	],
  "blocks": [
    {
      "type": "image",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link",
          "info": "Optional"
        },
        {
          "type": "text",
          "id": "image-title",
          "label": "Title",
          "default": "Gallery image"
        },
        {
          "type": "text",
          "id": "sub-title",
          "label": "Subtitle",
          "default": "View more"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Gallery",
      "category": "Image",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}